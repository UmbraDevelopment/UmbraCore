
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for UmbraCore - Secure Backup Management System">
      
      
        <meta name="author" content="MPY Development">
      
      
        <link rel="canonical" href="https://umbracore.dev/security-module-refactoring-architecture/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>UmbraCore Security Module Refactoring Architecture - UmbraCore Documentation</title>
      
    
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    <style>
        body {
            background-color: #000084;
            color: #ffffff;
        }
        
        .navbar {
            background-color: #000084;
            border-bottom: 1px solid #ffffff;
        }
        
        .navbar-default .navbar-nav > li > a {
            color: #ffffff;
        }
        
        .navbar-default .navbar-brand {
            color: #ffffff;
        }
        
        .well {
            background-color: #000084;
            border: 1px solid #ffffff;
        }
        
        code, pre {
            font-family: 'Monoid', monospace !important;
            background-color: #000084;
            color: #ffffff;
            border: 1px solid #ffffff;
        }
        
        a {
            color: #00ffff;
        }
        
        a:hover {
            color: #ffffff;
            text-decoration: none;
        }
        
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
        }
        
        .bs-sidebar .nav > li > a {
            color: #ffffff;
        }
        
        .bs-sidebar .nav > li > a:hover {
            color: #00ffff;
            background-color: transparent;
        }
        
        .form-control {
            background-color: #000084;
            color: #ffffff;
            border: 1px solid #ffffff;
        }
        
        table {
            border: 1px solid #ffffff;
        }
        
        th, td {
            border: 1px solid #ffffff;
            padding: 8px;
        }
        
        blockquote {
            border-left: 5px solid #ffffff;
            background-color: #000084;
        }
        
        .alert {
            background-color: #000084;
            border: 1px solid #ffffff;
            color: #ffffff;
        }
        
        footer {
            border-top: 1px solid #ffffff;
            color: #ffffff;
        }
    </style>

    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto Mono";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/css/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#umbracore-security-module-refactoring-architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="UmbraCore Documentation" class="md-header__button md-logo" aria-label="UmbraCore Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            UmbraCore Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              UmbraCore Security Module Refactoring Architecture
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mpy-dev-ml/UmbraCore" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="UmbraCore Documentation" class="md-nav__button md-logo" aria-label="UmbraCore Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    UmbraCore Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mpy-dev-ml/UmbraCore" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../getting-started/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/quick-start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../user-guide/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/advanced-features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../modules/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/umbracore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UmbraCore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/xpcprotocolscore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XPCProtocolsCore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/securityprotocolscore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SecurityProtocolsCore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/umbraxpc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UmbraXPC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/umbrakeychainservice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UmbraKeychainService
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/securitytypes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SecurityTypes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/umbracryptoservice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UmbraCryptoService
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/resticlihelper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ResticCLIHelper
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/errortypes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ErrorTypes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/repositorymanager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RepositoryManager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/backupcoordinator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BackupCoordinator
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../development/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Development
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/bazel_spm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bazel & SPM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/project_structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Structure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/xpc_implementation_plan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XPC Implementation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Support
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Support
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../support/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ACKNOWLEDGMENTS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgments
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Executive Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#current-module-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Current Module Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Current Module Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-fragmentation-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Module Fragmentation Issues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-circular-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Key Circular Dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#target-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Target Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Target Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-core-foundation-free-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1. Core Foundation-Free Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-foundation-bridge-layer" class="md-nav__link">
    <span class="md-ellipsis">
      2. Foundation Bridge Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-implementation-layer" class="md-nav__link">
    <span class="md-ellipsis">
      3. Implementation Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-binary-data-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      4. Binary Data Foundation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#module-dependency-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Module Dependency Diagram
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#type-mapping-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Type Mapping Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#module-consolidation-plan" class="md-nav__link">
    <span class="md-ellipsis">
      Module Consolidation Plan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Module Consolidation Plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-establish-foundation-free-core" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 1: Establish Foundation-Free Core
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-implement-single-bridge-layer" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2: Implement Single Bridge Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-clean-implementation-layer" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 3: Clean Implementation Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-remove-redundant-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 4: Remove Redundant Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Guidelines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Guidelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#protocol-consolidation" class="md-nav__link">
    <span class="md-ellipsis">
      Protocol Consolidation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sendable-conformance" class="md-nav__link">
    <span class="md-ellipsis">
      Sendable Conformance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-verification" class="md-nav__link">
    <span class="md-ellipsis">
      Module Verification
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-path-for-client-code" class="md-nav__link">
    <span class="md-ellipsis">
      Migration Path for Client Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
    <div class="content">
        
                  

  
  


<h1 id="umbracore-security-module-refactoring-architecture">UmbraCore Security Module Refactoring Architecture<a class="headerlink" href="#umbracore-security-module-refactoring-architecture" title="Permanent link">&para;</a></h1>
<h2 id="executive-summary">Executive Summary<a class="headerlink" href="#executive-summary" title="Permanent link">&para;</a></h2>
<p>This document outlines the architecture for refactoring the UmbraCore security modules based on the UmbraCore Refactoring Plan and Security Module Migration. The goal is to consolidate redundant modules, break circular dependencies, and establish a clean architecture with clear separation between Foundation-dependent and Foundation-free components.</p>
<h2 id="current-module-analysis">Current Module Analysis<a class="headerlink" href="#current-module-analysis" title="Permanent link">&para;</a></h2>
<h3 id="module-fragmentation-issues">Module Fragmentation Issues<a class="headerlink" href="#module-fragmentation-issues" title="Permanent link">&para;</a></h3>
<p>The security components are currently fragmented across multiple modules:</p>
<table>
<thead>
<tr>
<th>Module Category</th>
<th>Current Modules</th>
<th>Issues</th>
</tr>
</thead>
<tbody>
<tr>
<td>Protocol Definitions</td>
<td>SecurityInterfaces, SecurityInterfacesBase, SecurityInterfacesProtocols, SecurityProtocolsCore</td>
<td>Duplicate protocols, unclear ownership, circular dependencies</td>
</tr>
<tr>
<td>Foundation Bridges</td>
<td>SecurityInterfacesFoundation, SecurityInterfacesFoundationBridge, SecurityProviderBridge</td>
<td>Overlapping responsibilities, ambiguous type references</td>
</tr>
<tr>
<td>Implementations</td>
<td>UmbraSecurity, SecurityImplementation</td>
<td>Mixed concerns, direct Foundation dependencies</td>
</tr>
<tr>
<td>Supporting Types</td>
<td>SecurityTypes, SecureBytes, CryptoTypes</td>
<td>Inconsistent usage, multiple versions of similar types</td>
</tr>
</tbody>
</table>
<h3 id="key-circular-dependencies">Key Circular Dependencies<a class="headerlink" href="#key-circular-dependencies" title="Permanent link">&para;</a></h3>
<ol>
<li><code>SecurityInterfaces</code> ↔ <code>SecurityInterfacesFoundation</code></li>
<li><code>SecurityBridge</code> ↔ <code>SecurityInterfacesFoundationBridge</code></li>
<li><code>UmbraSecurity</code> ↔ <code>SecurityImplementation</code></li>
</ol>
<h2 id="target-architecture">Target Architecture<a class="headerlink" href="#target-architecture" title="Permanent link">&para;</a></h2>
<p>We will consolidate the modules into a clean, layered architecture:</p>
<h3 id="1-core-foundation-free-layer">1. Core Foundation-Free Layer<a class="headerlink" href="#1-core-foundation-free-layer" title="Permanent link">&para;</a></h3>
<p><strong>Primary Module: <code>SecurityProtocolsCore</code></strong></p>
<ul>
<li>Contains only foundation-free protocols and types</li>
<li>Uses <code>SecureBytes</code> for binary data representation</li>
<li>No direct or indirect Foundation dependencies</li>
<li>Core protocols:</li>
<li><code>SecurityProviderProtocol</code></li>
<li><code>CryptoServiceProtocol</code></li>
<li><code>KeyManagementProtocol</code></li>
<li>Core types:</li>
<li><code>SecurityError</code></li>
<li><code>SecurityOperation</code></li>
<li><code>SecurityConfigDTO</code></li>
<li><code>SecurityResultDTO</code></li>
</ul>
<h3 id="2-foundation-bridge-layer">2. Foundation Bridge Layer<a class="headerlink" href="#2-foundation-bridge-layer" title="Permanent link">&para;</a></h3>
<p><strong>Primary Module: <code>SecurityBridge</code></strong></p>
<ul>
<li>Single point of integration between Foundation and foundation-free types</li>
<li>Contains adapters and type converters</li>
<li>Depends on <code>SecurityProtocolsCore</code> and Foundation</li>
<li>Key components:</li>
<li><code>DataAdapter</code>: Converts between <code>Data</code> and <code>SecureBytes</code></li>
<li><code>URLAdapter</code>: Converts between <code>URL</code> and <code>ResourceLocator</code></li>
<li><code>FoundationSecurityProvider</code>: Foundation-specific security provider</li>
<li>Protocol adapters for all core protocols</li>
</ul>
<h3 id="3-implementation-layer">3. Implementation Layer<a class="headerlink" href="#3-implementation-layer" title="Permanent link">&para;</a></h3>
<p><strong>Primary Module: <code>SecurityImplementation</code></strong></p>
<ul>
<li>Concrete implementations of security protocols</li>
<li>May have Foundation dependencies (through <code>SecurityBridge</code>)</li>
<li>Contains service implementations and factories</li>
<li>Example components:</li>
<li><code>DefaultSecurityProvider</code></li>
<li><code>CryptoServiceImpl</code></li>
<li><code>KeyManagementImpl</code></li>
</ul>
<p><strong>Primary Module: <code>UmbraSecurity</code></strong></p>
<ul>
<li>High-level security service used by client code</li>
<li>Orchestrates security operations</li>
<li>Handles security-scoped bookmarks</li>
<li>Key components:</li>
<li><code>SecurityService</code></li>
<li><code>BookmarkService</code></li>
</ul>
<h3 id="4-binary-data-foundation">4. Binary Data Foundation<a class="headerlink" href="#4-binary-data-foundation" title="Permanent link">&para;</a></h3>
<p><strong>Primary Module: <code>SecureBytes</code></strong></p>
<ul>
<li>Core binary data representation</li>
<li>Zero Foundation dependencies</li>
<li>Fully Sendable for Swift concurrency</li>
<li>Memory-secure implementations</li>
<li>Used by all foundation-free modules</li>
</ul>
<h2 id="module-dependency-diagram">Module Dependency Diagram<a class="headerlink" href="#module-dependency-diagram" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>┌─────────────────┐      ┌───────────────┐
│   Client Code   │─────►│ UmbraSecurity │
└─────────────────┘      └───────┬───────┘
                                 │
                                 ▼
┌─────────────────┐      ┌───────────────┐
│   SecureBytes   │◄─────┤SecurityBridge │
└─────────────────┘      └───────┬───────┘
         ▲                       │
         │                       ▼
         │               ┌───────────────┐
         └───────────────┤SecurityProtocolsCore│
                         └───────────────┘
</code></pre></div>
<h2 id="type-mapping-strategy">Type Mapping Strategy<a class="headerlink" href="#type-mapping-strategy" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Domain Concept</th>
<th>Foundation-Free Type</th>
<th>Foundation Type</th>
<th>Bridge Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>Binary Data</td>
<td><code>SecureBytes</code></td>
<td><code>Data</code></td>
<td><code>DataAdapter.toSecureBytes(data)</code></td>
</tr>
<tr>
<td>Resource Location</td>
<td><code>ResourceLocator</code></td>
<td><code>URL</code></td>
<td><code>URLAdapter.toResourceLocator(url)</code></td>
</tr>
<tr>
<td>Error</td>
<td><code>SecurityError</code></td>
<td><code>NSError</code></td>
<td><code>ErrorAdapter.toSecurityError(error)</code></td>
</tr>
<tr>
<td>Configuration</td>
<td><code>SecurityConfigDTO</code></td>
<td><code>SecurityConfiguration</code></td>
<td><code>ConfigAdapter.toDTO(config)</code></td>
</tr>
</tbody>
</table>
<h2 id="module-consolidation-plan">Module Consolidation Plan<a class="headerlink" href="#module-consolidation-plan" title="Permanent link">&para;</a></h2>
<h3 id="phase-1-establish-foundation-free-core">Phase 1: Establish Foundation-Free Core<a class="headerlink" href="#phase-1-establish-foundation-free-core" title="Permanent link">&para;</a></h3>
<ol>
<li>Audit and consolidate <code>SecurityProtocolsCore</code></li>
<li>Ensure all core protocols are defined here</li>
<li>Remove any Foundation dependencies</li>
<li>Ensure Sendable conformance</li>
<li>
<p>Standardize on <code>SecureBytes</code> for binary data</p>
</li>
<li>
<p>Create comprehensive error model in <code>SecurityProtocolsCore.SecurityError</code></p>
</li>
<li>Define all security error cases</li>
<li>Provide localization keys</li>
<li>Document error recovery options</li>
</ol>
<h3 id="phase-2-implement-single-bridge-layer">Phase 2: Implement Single Bridge Layer<a class="headerlink" href="#phase-2-implement-single-bridge-layer" title="Permanent link">&para;</a></h3>
<ol>
<li>Consolidate all Foundation bridges into <code>SecurityBridge</code></li>
<li>Migrate adapters from <code>SecurityInterfacesFoundationBridge</code></li>
<li>Implement type converters for all domain types</li>
<li>
<p>Ensure proper error propagation</p>
</li>
<li>
<p>Create factory functions for module integration</p>
</li>
<li>Simplify creation of security services</li>
<li>Provide default implementations</li>
<li>Support dependency injection</li>
</ol>
<h3 id="phase-3-clean-implementation-layer">Phase 3: Clean Implementation Layer<a class="headerlink" href="#phase-3-clean-implementation-layer" title="Permanent link">&para;</a></h3>
<ol>
<li>Update <code>SecurityImplementation</code> to use <code>SecurityProtocolsCore</code></li>
<li>Remove direct Foundation dependencies</li>
<li>Use bridge layer for Foundation operations</li>
<li>
<p>Implement all required protocols</p>
</li>
<li>
<p>Refactor <code>UmbraSecurity</code> for clean service integration</p>
</li>
<li>Focus on high-level security operations</li>
<li>Use factories from bridge layer</li>
<li>Maintain backward compatibility</li>
</ol>
<h3 id="phase-4-remove-redundant-modules">Phase 4: Remove Redundant Modules<a class="headerlink" href="#phase-4-remove-redundant-modules" title="Permanent link">&para;</a></h3>
<p>After successful migration, remove these redundant modules:
- <code>SecurityInterfacesFoundationBase</code>
- <code>SecurityInterfacesFoundationBridge</code>
- <code>SecurityInterfacesFoundationCore</code>
- <code>SecurityInterfacesFoundationMinimal</code>
- <code>SecurityInterfacesFoundationNoFoundation</code>
- <code>SecurityProviderBridge</code> (functionality moved to <code>SecurityBridge</code>)</p>
<h2 id="implementation-guidelines">Implementation Guidelines<a class="headerlink" href="#implementation-guidelines" title="Permanent link">&para;</a></h2>
<h3 id="protocol-consolidation">Protocol Consolidation<a class="headerlink" href="#protocol-consolidation" title="Permanent link">&para;</a></h3>
<p>For each protocol currently defined in multiple places:</p>
<ol>
<li>Choose one canonical location in <code>SecurityProtocolsCore</code></li>
<li>Update all implementations to conform to this protocol</li>
<li>Create adapters in <code>SecurityBridge</code> if Foundation types are needed</li>
</ol>
<h3 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h3>
<ol>
<li>Define a single <code>SecurityError</code> enum in <code>SecurityProtocolsCore</code></li>
<li>Use Result<Success, SecurityError> for error propagation</li>
<li>Create mapping functions in <code>SecurityBridge</code> for NSError conversion</li>
</ol>
<h3 id="sendable-conformance">Sendable Conformance<a class="headerlink" href="#sendable-conformance" title="Permanent link">&para;</a></h3>
<ol>
<li>All types in <code>SecurityProtocolsCore</code> must be Sendable</li>
<li>Use actor isolation for state management</li>
<li>Avoid shared mutable state</li>
</ol>
<h3 id="module-verification">Module Verification<a class="headerlink" href="#module-verification" title="Permanent link">&para;</a></h3>
<p>After implementing each phase, verify:
1. No circular dependencies (use <code>dependency_analyzer.sh</code>)
2. All tests pass (run appropriate test suites)
3. Client code integrates correctly</p>
<h2 id="migration-path-for-client-code">Migration Path for Client Code<a class="headerlink" href="#migration-path-for-client-code" title="Permanent link">&para;</a></h2>
<ol>
<li>Update import statements</li>
<li>Replace <code>import SecurityInterfaces</code> with <code>import SecurityProtocolsCore</code></li>
<li>
<p>Replace <code>import SecurityInterfacesFoundation*</code> with <code>import SecurityBridge</code></p>
</li>
<li>
<p>Update type usage</p>
</li>
<li>Replace Foundation types with domain types</li>
<li>
<p>Use adapters for type conversion</p>
</li>
<li>
<p>Verify protocol conformance</p>
</li>
<li>Ensure all required methods are implemented</li>
<li>Check Sendable conformance where needed</li>
</ol>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>This architecture provides a clean separation of concerns, breaks circular dependencies, and reduces module count while maintaining functionality and performance. By following this plan, we will achieve the goals outlined in the UmbraCore Refactoring Plan while ensuring a smooth migration path for client code.</p>












                
    </div>

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "toc.follow", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>